[TOC]

# ES的结构

> ES的服务中，可以创建多个索引
>
> 每一个索引默认被分成5片存储
>
> 每一个分片都会存在至少一个备份分片
>
> 备份分片默认不会帮助检索数据，当ES检索压力特别大时，备份分片才会帮助索引数据。
>
> 备份分片必须放在不同的服务器中。

![image-20240822163909995](https://fastly.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408221639041.png)

>  一个索引下，可以创建多个类型
>
> 根据版本不同，类型的创建也不同

![image-20240822164310615](https://fastly.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408221643665.png)

> 一个类型下，可以用多个文档。这个文档类似于数据库表中的多个文档。

![image-20240822164600866](https://fastly.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408221646909.png)

> 一个文档中可以包含多个属性。类似于mysql表中的一行可以有多个列的数据。

![image-20240822164815297](https://fastly.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408221648344.png)



# ES的类型

查看[官方文档](https://www.elastic.co/guide/en/elasticsearch/reference/8.12/text.html)：

> **字符串类型**：
>
> ​	text：一般被用于全文检索。将当前的Field进行分词
>
> ​	ketword：当前的Field不会被分词
>
> **数值类型**：
>
> ​	long：
>
> ​	integer：
>
> ​	short：
>
> ​	byte：
>
> ​	double：
>
> ​	float：
>
> ​	half_float：精度比float小一半
>
> ​	scaled_float：根据一个long和scaled来表达一个浮点型，long-345，scaled-100 ->3.45
>
> **时间类型**：
>
> ​	date类型，针对时间类型指定具体的格式
>
> **布尔类型**：
>
> ​	boolean类型，表示true和false
>
> **二进制类型**：
>
> ​	binary类型暂时支持Base64 encode string
>
> **范围类型**：
>
> ​	long_range：赋值时，无需指定具体的内容，只需要存储一个范围即可，指定gt，lt，gte，lte
>
> ​	float_range：同上
>
> ​	long_range：同上
>
> ​	double_range：同上
>
> ​	date_range：同上
>
> ​	ip_range：同上
>
> **经纬度类型**：
>
> ​	geo_point：用来存储经纬度的
>
> **IP类型**：
>
> ​	ip：可以存储IPV4或者IPV6



## 创建索引并指定结构

测试版本为ES8.12.2

```js
# 创建索引并指定结构
PUT /book
{
  "settings": {
    "number_of_shards": 5, # 指定分片数
    "number_of_replicas": 1 # 指定备份数
  },
  "mappings": {
    "properties": { # 文档存储的Field
      "name": { # Field属性名
        "type": "text", # 类型
        "analyzer": "standard", # 分词器
        "index": true, # 指定当前的Field可以被作为查询的条件
        "store": false # 是否需要额外存储
      },
      "author": {
        "type": "keyword"
      },
      "count": {
        "type": "long"
      },
      "on-sale": {
        "type": "date", 
        "format": "yyyy-MM-dd HH:mm:ss||yyyy-MM-dd||epoch_millis" # 指定时间的格式化方式
      },
      "descr": {
        "type": "text",
        "analyzer": "standard"
      }
    }
  }
}
```

返回：

```js
{
  "acknowledged": true,
  "shards_acknowledged": true,
  "index": "book"
}
```

![image-20240822172642441](https://fastly.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408221726482.png)



## 新建文档内容

> 文档在ES服务中的唯一标识是：`_index`、`_type`、`_id`三个内容为组合，唯一确定一个文档。根据这三个内容决定是添加还是修改。

- 添加文档，手动指定id

```json
# 添加文档,自动生成id
POST /book/_doc/1
{
  "name": "盘龙",
  "author": "我爱吃西红柿",
  "count": 100000,
  "on-sale": "2000-01-01",
  "descr": "汉哀啊卡啊很 扽asda"
}

或者
PUT /book/_doc/1
{
  "name": "红楼梦",
  "author": "我爱吃西红柿",
  "count": 100000,
  "on-sale": "2000-01-01",
  "descr": "汉哀啊卡啊很 扽asda"
}
```

输出：

```json
{
  "_index": "book",
  "_id": "1",
  "_version": 1,
  "result": "created", # 如果_id的值已经出现过，那么这个地方会变成updated
  "_shards": {
    "total": 2,
    "successful": 1,
    "failed": 0
  },
  "_seq_no": 0,
  "_primary_term": 1
}
```



## 修改文档

全量修改内容：

```json
PUT /book/_doc/1
{
  "name": "红楼梦",
  "author": "我爱吃西红柿",
  "count": 100000,
  "on-sale": "2000-01-01",
  "descr": "汉哀啊卡啊很 扽asda"
}
```

还有一种部分更新的方式，以后用到了再看吧。



