[toc]

# 条件构造器与常用接口

## 1、wrapper

![image-20240830145323550](https://gcore.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408301453602.png)

- Wrapper：条件构造抽象类，最顶端的父类
  - AbstractWrapper：用于查询条件封装，生成sql的where条件语句
    - QueryWrapper：查询条件封装
    - UpdateWrapper：Update条件封装
    - AbstractLambdaWrapper：使用Lambda语法
      - LambdaQueryWrapper：用于Lambda语法使用的查询Wrapper
      - LambdaUpdateWrapper：Lambda更新封装Wrapper

详细的使用文档请查看：[条件构造器](https://baomidou.com/guides/wrapper/)

> 查询条件构造器

```java
@SpringBootTest
public class MyBatisPlusWrapperTest {
    @Autowired
    private UserServiceImpl userServiceImpl;

    @Test
    public void testSelectList() {
        // 查询用户名包含a，年龄在20到30之间，邮箱信息不为null的用户信息
        QueryWrapper<User> queryWrapper = new QueryWrapper<>();
        queryWrapper.like("name", "a")
                .between("age", 18, 20)
                .isNotNull("email");
        List<User> list = userServiceImpl.list(queryWrapper);
        list.forEach(System.out::println);
    }    
}
```

![image-20240830152949652](https://cdn.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408301529689.png)

```java
@Test
public void test01(){
    // 查询用户信息，按照年龄的降序排序，若年龄相同，则按照id升序排序
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    queryWrapper.orderByDesc("age")
            .orderByAsc("uid");
    List<User> list = userServiceImpl.list(queryWrapper);
    list.forEach(System.out::println);
}
```

![image-20240830153031422](https://cdn.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408301530471.png)

```java
@Test
public void test05(){
    // 查询用户的用户名、年龄、邮箱信息
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    queryWrapper.select("name", "age", "email");
    userMapper.selectMaps(queryWrapper).forEach(System.out::println);
}
```

![image-20240830174752178](https://cdn.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408301747230.png)

> [!TIP]
>
> 组装子查询

```java
@Test
public void test06(){
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    queryWrapper.inSql("uid", "select uid from user where age>20");
    userServiceImpl.list(queryWrapper).forEach(System.out::println);
}
```

![image-20240830175152063](https://cdn.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408301751114.png)

> [!NOTE]
>
> 查询时判断条件不为空

```java
@Test
public void test08(){
    String username = "";
    Integer ageBegin = 20;
    Integer ageEnd = 30;
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    // StringUtils用的是mybatis包下的
    if (StringUtils.isNotBlank(username)) {
        // isNotBlank判断某个字符串不为空，不为null，不为空白字符
        queryWrapper.like("name", username);
    }
    if (ageBegin != null) {
        queryWrapper.ge("age", ageBegin);
    }
    if (ageEnd != null) {
        queryWrapper.le("age", ageEnd);
    }
    userMapper.selectList(queryWrapper).forEach(System.out::println);
}
```

![image-20240902194146806](https://gcore.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202409021941395.png)

> [!TIP]
>
> 针对上述的情况一个简单的写法：
>
> 语法：like()，le()，ge()等的第一个参数有一个判断条件，如果条件符合，则把条件添加进去，如果不符合就不进行添加。

```java
@Test
public void test09(){
    String name = "a";
    String ageBegin = "20";
    String ageEnd = "30";
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    queryWrapper.like(StringUtils.isNotBlank(name), "name", name)
            .ge(StringUtils.isNotBlank(ageBegin), "age", ageBegin)
            .le(StringUtils.isNotBlank(ageEnd), "age", ageEnd);
    userMapper.selectList(queryWrapper).forEach(System.out::println);
}
```

![image-20240902194639223](https://gcore.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202409021946287.png)

> 删除条件构造器

```java
@Test
public void test02(){
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    queryWrapper.isNull("email");
    boolean result = userServiceImpl.remove(queryWrapper);
    System.out.println(result);
}
```

在删除中仍然使用的是QueryWrapper条件构造器。

![image-20240830160924742](https://cdn.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408301609791.png)

> 修改条件构造器

```java
@Test
public void test03(){
    // 将年龄大于20并且用户名中包含有a或邮箱为null的用户信息修改
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    queryWrapper.gt("age", 20)
                    .like("name", "a")
                    .or()
                    .isNull("email");
    User user = new User();
    user.setAge(23);
    user.setName("小明");
    boolean update = userServiceImpl.update(user, queryWrapper);
    System.out.println(update);
}
```

![image-20240830161923493](https://gcore.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408301619536.png)

```java
@Test
public void test04(){
    // 将用户名中包含有a并且（年龄大于20或邮箱为null）的用户信息修改
    QueryWrapper<User> queryWrapper = new QueryWrapper<>();
    queryWrapper.like("name", "a")
            .and(i->i.gt("age", 20).or().isNull("email"));
    User user = new User();
    user.setName("小红");
    user.setEmail("test@atguigu.com");
    boolean update = userServiceImpl.update(user, queryWrapper);
    System.out.println(update);
}
```

![image-20240830170848251](https://gcore.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408301708298.png)

> [!NOTE]
>
> **UpdateWrapper不仅可以写查询条件还可以set设置值**

```java
@Test
public void test07(){
    // 将用户名中包含a并且（年龄大于20或邮箱为null）的用户信息修改
    UpdateWrapper<User> updateWrapper = new UpdateWrapper<>();
    updateWrapper.like("name", "a")
            .and(i->i.gt("age", 20).or().isNull("email"))
            .set("email", "abc@atguigu.com")
            .set("name", "guigu");
    boolean update = userServiceImpl.update(updateWrapper);
    System.out.println(update);
}
```

![image-20240830180022750](https://gcore.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408301800805.png)



> **LambdaQueryWrapper**

```java
@Test
public void test10(){
    String name = "";
    Integer ageBegin = 20;
    Integer ageEnd = 30;
    LambdaQueryWrapper<User> queryWrapper = new LambdaQueryWrapper<>();
    queryWrapper.like(StringUtils.isNotBlank(name), User::getName, name)
            .ge(ageBegin != null, User::getAge, ageBegin)
            .le(ageEnd != null, User::getAge, ageEnd);
    userServiceImpl.list(queryWrapper).forEach(System.out::println);
}
```

![image-20240902195313248](https://gcore.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202409021953318.png)

> [!NOTE]
>
> **注意**：在使用LambdaQueryWrapper时，传入的字段名就是对象的属性名，这里使用的是函数式编程。
