[TOC]

# 持久层接口

介绍了Mybatis-plus进行持久化操作的各种方法，包括插入，更新，删除，查询和分页等。

## Service Interface

[IService](https://gitee.com/baomidou/mybatis-plus/blob/3.0/mybatis-plus-extension/src/main/java/com/baomidou/mybatisplus/extension/service/IService.java)是MyBatis-Plus提供的一个通用的Service层接口，它封装了常见的CRUD操作，包括插入，删除，更新，查询和分页等。通过继承IService接口，可以快速实现对数据库的基本操作，同时保持代码的间接性和可维护性。

IService接口中的命名方法遵循一定的规范，如get用于查询单行，remove用于删除，list用于查询集合，page用于分页查询，这样就可以避免与Mapper层的方法混淆。

> 泛型`T`为任意实体对象
>
> 建议如果存在自定义通用 Service 方法的可能，请创建自己的 `IBaseService` 继承 `Mybatis-Plus` 提供的 `IService` 基类
>
> 对象Wrapper为[条件构造器](https://baomidou.com/guides/wrapper)

具体的文档说明，请参阅[持久层|MyBatis-Plus](https://baomidou.com/guides/data-interface/)

下图是IService的接口：

![image-20240830103329615](https://cdn.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408301048300.png)

下图则是IService的实现类ServiceImpl：

![image-20240830103439179](https://cdn.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408301048670.png)

从上图我们可以看出，ServiceImpl实现类了IService，并且传入了BaseMapper的子类以及泛型T。

**一般不建议直接使用IService作为自己的持久层，一般都是自定义自己的持久层。**

首先，在自定义自己的持久层时，将自己的UserService接口继承IService：

```java
package com.lqy.mybatisplus.service;

import com.baomidou.mybatisplus.extension.service.IService;
import com.lqy.mybatisplus.pojo.User;

/**
 * @ClassName: UserService
 * @Description:
 * @Author: lengqy
 * @Date: 2024/8/30 10:10
 **/
public interface UserService extends IService<User> {
}
```

其次，写一个实现类UserServiceImpl实现UserService，为了避免重写IService里面的方法，我们可以继承ServiceImpl类，并将其中的Mapper和泛型换成自己的：

```java
package com.lqy.mybatisplus.service.impl;

import com.baomidou.mybatisplus.extension.service.impl.ServiceImpl;
import com.lqy.mybatisplus.mapper.UserMapper;
import com.lqy.mybatisplus.pojo.User;
import com.lqy.mybatisplus.service.UserService;
import org.springframework.stereotype.Service;

/**
 * @ClassName: UserServiceImpl
 * @Description:
 * @Author: lengqy
 * @Date: 2024/8/30 10:12
 **/
@Service
public class UserServiceImpl extends ServiceImpl<UserMapper, User> implements UserService {
}
```

最后在自己的实现类UserServiceImpl上添加注解@Service，表明这是一个服务组件。

接下来就可以使用了：

```java
@SpringBootTest
public class MyBatisPlusServiceTest {
    @Autowired
    private UserServiceImpl userService;

    @Test
    public void testGetCount() {
        // 查询总记录数
        long count = userService.count();
        System.out.println(count);
    }

    @Test
    public void testBatchInsert() {
        // 批量添加
        List<User> list = new ArrayList<>();
        for (int i = 0; i < 10; i++) {
            User user = new User();
            user.setName("ybc" + i);
            user.setAge(i+20);
            list.add(user);
        }
        boolean b = userService.saveBatch(list);
        System.out.println(b);
    }
}
```

![image-20240830110116020](https://cdn.jsdelivr.net/gh/lqyspace/AI-master-img@master/img/202408301101074.png)

从打印的日志可以发现，在批量添加时，执行的是单个的添加语句。
